<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Battle Talent: Welcome to the Scripting Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Battle Talent
   &#160;<span id="projectnumber">0.0.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Welcome to the Scripting Document </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_Z__WorkSpace_ProjSAO_ProjSAO_Assets_Scripts_doc"></a> You can query these API, then use them in lua, looking forward to seeing what everyone will do. We will open more system in the future, currently we only export weapon related tools(in C#).</p>
<h4><a class="anchor" id="autotoc_md1"></a>
Quick Start</h4>
<ol type="1">
<li>install Unity 2019.4.12f(download <a href="https://unity3d.com/get-unity/download">UnityHub</a>, then download Engine via Hub)</li>
<li>download <a href="https://github.com/fonzieyang/BTModToolkit">ModProj</a></li>
<li>open the project, then click BuildTools/BuildAllBundles</li>
<li>copy the mod files to the corresponding path:<ul>
<li>Windows: C:\Users[username]\AppData\LocalLow\CrossLink\BattleTalent\Mods</li>
<li>Quest: /sdcard/Android/data/com.CrossLink.SAO/files/Mods/</li>
</ul>
</li>
<li>Done! (if something goes wrong, please open your cheat menu then tell us about your error messages)</li>
</ol>
<p>if you just want to try play this mod, you can download it from <a href="https://github.com/fonzieyang/BTModToolkit/releases/download/V0.0.1/ModProj.zip">HERE</a></p>
<h4><a class="anchor" id="autotoc_md2"></a>
Make your first weapon with BTModToolkit in 10 mintues</h4>
<p>please check out this <a href="https://youtu.be/IqPl5KRgZ8Y">Weapon Modding Video</a>, for more details please check out this <a href="https://docs.google.com/spreadsheets/d/1z3dAbbIpCERFYRC-NOEZxo7R3kv008184Jws9MFz2NI/edit?usp=sharing">Weapon Modding Doc</a></p>
<h4><a class="anchor" id="autotoc_md3"></a>
Before release your own mod</h4>
<p>please make sure you've <em>cleared the project</em> and <em>renamed the product</em></p>
<p>two ways to clear the example project:</p><ul>
<li>remove the pre-added addressables(window-&gt;asset management-&gt;addressables-&gt;group)</li>
<li>delete the Examples folder(Assets/Examples)</li>
</ul>
<p>the way to change product name:</p><ul>
<li>Edit -&gt; Project Settings -&gt; Modify the Project Name</li>
</ul>
<h4><a class="anchor" id="autotoc_md4"></a>
Tips for scripting in lua:</h4>
<ul>
<li>namespace of CShape code is CS in lua</li>
<li>namespace <a class="el" href="namespace_cross_link.html">CrossLink</a> is CL in lua, CL == CS.CrossLink</li>
<li>namespace UnityEngine is UE in lua, UE == CS.UnityEngine</li>
<li>calling a static function should use '.' instead of ':' in lua</li>
<li>recommend using <a href="https://studio.zerobrane.com/">ZeroBrane Studio</a> as lua editor</li>
</ul>
<h4><a class="anchor" id="autotoc_md5"></a>
TODO</h4>
<ul>
<li>lua grammar completion(ZeroBrane based)</li>
<li>lua break point debug(ZeroBrane based)</li>
<li>level modding</li>
<li>npc modding</li>
<li>player modding</li>
</ul>
<h4><a class="anchor" id="autotoc_md6"></a>
Related Manual</h4>
<ul>
<li><a href="https://docs.unity3d.com/2019.4/Documentation/Manual/">Unity manual</a></li>
<li><a href="https://www.lua.org/manual/5.1/">Lua manual</a></li>
<li><a href="https://github.com/Tencent/xLua/blob/master/README_EN.md">Xlua</a></li>
<li><a href="https://docs.moodkie.com/easy-save-3/es3-api/es3-class/">EasySave3</a></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md8"></a>
Basic Concept</h1>
<p>Battle Talent is fully driven by physics, so every collider in this game, we can find the logic object they belonged to(except environment).</p>
<h4><a class="anchor" id="autotoc_md9"></a>
check what we got by a collider or rigidbody</h4>
<pre class="fragment">local pu = CL.PhysicsUnit.GetPhysicsUnit(collider)
if (pu == nil || pu:IsScene()) then
    print("Env")
else
    print(pu.unitType)
end

local puRB = CL.PhysicsUnit.GetPhysicsUnit(rigidbody.transform)
if (puRB == nil || puRB:IsScene()) then
    print("Env")
else
    print(puRB.unitType)
end
</pre> <h4><a class="anchor" id="autotoc_md10"></a>
here's the enum and the class</h4>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">enum name   </th><th class="markdownTableHeadLeft">class name    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">FlyObject   </td><td class="markdownTableBodyLeft"><a href="class_cross_link_1_1_fly_object.html">FlyObject</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">SceneObject   </td><td class="markdownTableBodyLeft"><a href="class_cross_link_1_1_scene_object.html">SceneObject</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InteractRole   </td><td class="markdownTableBodyLeft"><a href="class_cross_link_1_1_full_character_control.html">FullCharacterControl</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">InteractWeapon   </td><td class="markdownTableBodyLeft"><a href="class_cross_link_1_1_interact_weapon.html">InteractWeapon</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">PlayerRole   </td><td class="markdownTableBodyLeft"><a href="class_cross_link_1_1_player_unit.html">PlayerUnit</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">PlayerHand   </td><td class="markdownTableBodyLeft"><a href="class_cross_link_1_1_physics_hand.html">PhysicsHand</a>   </td></tr>
</table>
<h4><a class="anchor" id="autotoc_md11"></a>
layer settings</h4>
<p>check out <a href="class_cross_link_1_1_layer_define.html">LayerDefine</a> to find all the layers we predefined</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadLeft">layer name   </th><th class="markdownTableHeadLeft">physics object associated    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">BodyMask   </td><td class="markdownTableBodyLeft">Npc&amp;Player's Bodypart    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyLeft">EnvLayerMask   </td><td class="markdownTableBodyLeft">Environment    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyLeft">InteractLayerMask   </td><td class="markdownTableBodyLeft">Weapon, Item, Part of BodyPart   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md13"></a>
Commonly used classes</h1>
<h4><a class="anchor" id="autotoc_md14"></a>
Basic Classes</h4>
<ul>
<li><a href="class_cross_link_1_1_scheduler.html">Scheduler</a></li>
<li><a href="class_cross_link_1_1_language_mgr.html">LanguageMgr</a></li>
<li><a href="class_cross_link_1_1_language_mgr.html">EffectMgr</a></li>
<li><a href="class_cross_link_1_1_audio_mgr.html">AudioMgr</a></li>
<li><a href="class_cross_link_1_1_resource_mgr.html">ResourceMgr</a></li>
<li><a href="class_cross_link_1_1_game_data_mgr.html">GameDataMgr</a></li>
<li><a href="class_cross_link_1_1_x_lua_mgr.html">XLuaMgr</a></li>
</ul>
<h4><a class="anchor" id="autotoc_md15"></a>
GamePlay Related Classes</h4>
<ul>
<li><a href="class_cross_link_1_1_hit_info_config.html">HitInfoConfig</a></li>
<li><a href="class_cross_link_1_1_unlock_content_config.html">UnlockContentConfig</a></li>
<li><a href="class_cross_link_1_1_a_i_proxy.html">AIProxy</a></li>
<li><a href="class_cross_link_1_1_character_combat_attr.html">CharacterCombatAttr</a></li>
<li><a href="class_cross_link_1_1_full_body_muscle_state.html">FullBodyMuscleState</a></li>
<li><a href="class_cross_link_1_1_buffer_mgr.html">BuffMgr</a></li>
<li><a href="class_cross_link_1_1_interact_base.html">InteractBase</a></li>
<li><a href="class_cross_link_1_1_hud_mgr.html">HUDMgr</a></li>
<li><a href="class_cross_link_1_1_player_data_mgr.html">PlayerDataMgr</a></li>
<li><a href="class_cross_link_1_1_level_data_mgr.html">LevelDataMgr</a></li>
</ul>
<h4><a class="anchor" id="autotoc_md16"></a>
Lua Host Classes</h4>
<ul>
<li><a href="class_cross_link_1_1_lua_behaviour.html">LuaBehaviour</a></li>
<li><a href="class_cross_link_1_1_interact_trigger_x.html">InteractTriggerX</a></li>
<li><a href="class_cross_link_1_1_fly_object_x.html">FlyObjectX</a></li>
</ul>
<p>For lua host script, check the LuaFunction in each class, that's the event they will receive.</p>
<p>For example, InteractTriggerX has luaCloseSkill, then it'll recive CloseSkill Event</p>
<p>exceptional case:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">LuaFunction name   </th><th class="markdownTableHeadCenter">actual event name    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter">AwakeInit   </td><td class="markdownTableBodyCenter">Awake    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyCenter">StartInit   </td><td class="markdownTableBodyCenter">Start   </td></tr>
</table>
<p>For example, InteractTriggerX has luaAwakeInit, but it'll receive Awake Event instead of AwakeInit</p>
<hr  />
<h1><a class="anchor" id="autotoc_md18"></a>
Coding Examples</h1>
<h4><a class="anchor" id="autotoc_md19"></a>
tick a function</h4>
<pre class="fragment">local scheId = CL.Scheduler.Create(target,
function(sche, t, s)
    local progress = t/s
    print("updating:" .. progress)
    if (t&gt;=s) then
        print("finished succ")
    end
end
, 0.1, 10, 0.2)
:SetUpdateChannel(CL.Scheduler.UpdateChannel.FixedUpdate)
:IgnoreTimeScale(true)
:SetOnStop(function(sche)
    print("on stop")
end).actionId
CL.Scheduler.RemoveScheduler(scheId)
</pre> <h4><a class="anchor" id="autotoc_md20"></a>
add store item</h4>
<pre class="fragment">storeItem = CL.UnlockContentItem()
storeItem.name = weaponName
storeItem.dependItemName = dependWeapon
storeItem.iconName = weaponName
storeItem.contentType = CL.UnlockContentConfig.UnlockContentType.Weapon
storeItem.unlockRequireCoinNum = 1
CL.UnlockContentConfig.AddItem(storeItem)
</pre> <h4><a class="anchor" id="autotoc_md21"></a>
add a new hitinfo to the config file</h4>
<pre class="fragment">HitInfoConfig = CL.GameDataMgr.GetData(typeof(CL.HitInfoConfig))
local lightBladeHitInfo = CL.HitInfoConfig.HitInfoConfigItem()
lightBladeHitInfo.Name = "WMD_LightBlade"
lightBladeHitInfo.VelocityMlp = 1.5
lightBladeHitInfo.DamageMlp = 30
lightBladeHitInfo.DamageThrough = 1.5
lightBladeHitInfo.DamageCrit = 1.5
lightBladeHitInfo.StabMlp = 1.5
lightBladeHitInfo.HitMlp = 120
lightBladeHitInfo.HitRandom = 0.2
lightBladeHitInfo.StabDamage = 120
lightBladeHitInfo.BreakDefenceMlp = 1
lightBladeHitInfo.HitBackMlp = 90
lightBladeHitInfo.KnockoutFactor = 0.1
lightBladeHitInfo.DizzyFactor = 0
lightBladeHitInfo.StiffValue = 2.5
HitInfoConfig:AddData(lightBladeHitInfo)
</pre><h4><a class="anchor" id="autotoc_md22"></a>
check npc's hp</h4>
<pre class="fragment">if (pu.unitType == CL.Tagger.Tag.InteractRole) then
    local fc = pu
    print(fc.attr.HpBase)
    // even change camp(from enemy to friend)
    if (fc.attr.camp == "Bad") then
        fc.attr:ChangeCamp()
    end     
end
</pre><h4><a class="anchor" id="autotoc_md23"></a>
apply hit scan(in C#), raycast with the weapon's direction then apply hitscan dmg</h4>
<pre class="fragment">if (Physics.SphereCast(interact.trans.position +
        interact.trans.forward * slashDetectOffset, 0.2f,
        interact.trans.forward,
        out hitInfo, slashDis, slashLayer))
{
        InteractTrigger.SetOverrideHitInfo(rgHitInfo);
        InteractTrigger.BeginScanDmg();
        InteractTrigger.AddHitScanProtect();
        InteractTrigger.ApplyHitScanDamage(hitInfo.collider, interact,
                interact.rb, hitCol, interact.rb.velocity.normalized,
                holdingCharacter.aiProxy.GetCamp());
        InteractTrigger.EndHitScan();
        InteractTrigger.SetOverrideHitInfo(null);
        if (InteractTrigger.ScanHited)
        {
                windCutSound.Play(hitInfo.point);
        }                
}
</pre><h4><a class="anchor" id="autotoc_md24"></a>
search enemies around you(in C#), the value of paramter camp is only "Good" and "Bad"</h4>
<pre class="fragment">static public AIProxy GetCloestTarget(Transform self, string camp, bool goodRelate = true, bool includeDown = false)
{
        AIProxy target = null;
        float minDis = 10000;

        var allChar = AIProxy.GetAroundAITarget();
        var charIte = allChar.GetEnumerator();

        while (charIte.MoveNext()){
                var proxy = charIte.Current.Value;

                if (includeDown == false &amp;&amp; proxy.IsDown())
                        continue;

                if (proxy.GetTransform() == self || proxy.gameObject.activeInHierarchy == false)
                        continue;

                var rela = SocietyMgr.GetSocietyInfo().GetCampRelationTo(camp, proxy.GetCamp());
                if ((goodRelate &amp;&amp; rela &gt; 0)||
                        (!goodRelate &amp;&amp; rela &lt; 0)){
                        var dis = (proxy.GetTransform().position - self.position).sqrMagnitude;
                        if (dis &lt; minDis){
                                minDis = dis;
                                target = proxy;
                        }
                }
        }
        return target;
}
</pre> <h4><a class="anchor" id="autotoc_md25"></a>
xlua tips</h4>
<pre class="fragment">// cast &amp; typeof example
cast(castObj, typeof(CL.TestCastClass))

// the way we implemented oop
function Clone(t, cpFunc)
    cpFunc = cpFunc or true
    if type(t) ~= 'table' then return t end
    local meta = getmetatable(t)
    local target = {}
    for k, v in pairs(t) do
            if type(v) == 'table' then
                    target[k] = Clone(v, cpFunc)
            else
                    if not cpFunc and type(v) == 'function' then
                    else
                            target[k] = v
                    end            
            end
    end
    setmetatable(target, meta)
    return target
end

local getmetatable = getmetatable
function Class(base,static,instance)

    local mt = nil
    if (base ~= nil) then
            mt = getmetatable(base)
    end

    local class = static or {}

    local callfunc
    callfunc = function(cls, ...)
                            local r = nil
                            if (mt ~= nil) then
                                    r = mt.__call(cls, ...)
                            end
                            local ret
                            if instance ~= nil then
                                    ret = Clone(instance, false)
                            else
                                    ret = {}
                            end

                            local ins_ret = setmetatable(
                                    {
                                            __base = r,
                                    },

                                    {
                                            __index = function(t, k)
                                                    local ret_field
                                                    ret_field = rawget(t,k)
                                                    if nil ~= ret_field then
                                                            return ret_field
                                                    end

                                                    ret_field = ret[k]
                                                    if nil == ret_field and r ~= nil then
                                                            ret_field = r[k]
                                                    end
                                                    return ret_field
                                            end,

                                            __newindex = function(t,k,v)
                                                    if r == nil or r[k] == nil then
                                                            rawset(t,k,v)
                                                    else
                                                            r[k] = v
                                                    end
                                            end,
                                    })

                            if ret.ctor then
                                    ins_ret:ctor(...)
                            end

                            return ins_ret
                    end

    setmetatable(class,
            {
                    __index = function(t, k)
                                            if k == 'CreateFromClass' then
                                                    return callfunc
                                            end

                                            if base ~= nil and base[k] ~= nil then
                                                    return base[k]
                                            end

                                            if instance ~= nil and instance[k] ~= nil then
                                                    return instance[k]
                                            end                    
                                        end,

                    __call = callfunc,
            }
    )
    return class
end
";
</pre> <hr  />
 </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
